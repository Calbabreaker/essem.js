/*!
 * essem - v0.0.0
 * Compiled Mon, 08 Mar 2021 05:57:51 GMT
 *
 * Free to use under the MIT LICENSE.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).ESSEM={})}(this,(function(t){"use strict";class e{constructor(t,e){this.availiable=[],this.totalObjects=0,this.ObjectClass=t,this.reserve(e)}acquire(){if(0===this.availiable.length){const t=Math.round(1.2*this.totalObjects)+1;this.reserve(t)}return this.availiable.shift()}release(t){this.availiable.push(t)}reserve(t){for(let e=0;e<t;e++){const t=new this.ObjectClass;this.availiable.push(t)}this.totalObjects+=t}}class n extends Error{constructor(t){super(t),this.name="AssertionError"}}function s(t,e){if(!t)throw new n(e)}class i{constructor(){this.destroyed=!1,this.componentMap=new Map}addComponent(t){const e=t.constructor.name,n=this._manager.getEntityIDSet(e);return s(!this.componentMap.has(e),`Component '${e}' already exists!`),this.componentMap.set(e,t),n.add(this),this._manager.notifySystemEntityChange(),t}removeComponent(t){var e;const n=null!==(e=t.name)&&void 0!==e?e:t,i=this._manager.getEntityIDSet(n);s(this.componentMap.has(n),`Component '${n}' does not exist!`),this.componentMap.delete(n),i.delete(this),this._manager.notifySystemEntityChange()}hasComponent(t){var e;const n=null!==(e=t.name)&&void 0!==e?e:t;return this.componentMap.has(n)}getComponent(t){var e;const n=null!==(e=t.name)&&void 0!==e?e:t,i=this.componentMap.get(n);return s(void 0!==i,`Component '${n}' does not exist!`),i}destroy(){if(!this.destroyed){for(const[t]of this.componentMap){const e=this._manager.getEntityIDSet(t);this.componentMap.delete(t),e.delete(this)}this._manager.notifySystemEntityChange(),this.destroyed=!0}}_setup(){this.destroyed&&(this.destroyed=!1)}}class o{constructor(){this.managerEntity=class extends i{},this.systems=[],this.managerEntity.prototype._manager=this,this.entityPool=new e(this.managerEntity,100),this.componentToEntityIDsMap=new Map}registerComponent(t){const e=t.name;s(!this.componentToEntityIDsMap.has(e),`Component '${e}' is already registered!`),this.componentToEntityIDsMap.set(e,new Set)}registerSystem(t){const e=new t(this);e.onInit(),this.systems.push(e)}runSystems(t){for(const e of this.systems)e.onUpdate(t)}createEntity(){return this.entityPool.acquire()}destroyEntity(t){t.destroy(),this.entityPool.release(t),this.notifySystemEntityChange()}getEntityIDSet(t){const e=this.componentToEntityIDsMap.get(t);return s(void 0!==e,`Component '${t}' has not been registered!`),e}notifySystemEntityChange(){for(const t of this.systems)t._entityGetCache=null}}class a{constructor(t){this._manager=t}createEntity(){return this._manager.createEntity()}destroyEntity(t){this._manager.destroyEntity(t)}}t.Application=class{constructor(){this.lastFrameTime=0,this.running=!0,this._manager=new o,window.addEventListener("load",(()=>{const t=()=>{this.running&&(this._onUpdate(),requestAnimationFrame(t))};requestAnimationFrame(t)}))}_onUpdate(){const t=performance.now(),e=t-this.lastFrameTime;this._manager.runSystems(e),this.lastFrameTime=t}shutdown(){this.running=!1}registerComponent(t){return this._manager.registerComponent(t),this}registerSystem(t){return this._manager.registerSystem(t),this}createScene(){return new a(this._manager)}},t.AssertionError=n,t.Entity=i,t.Manager=o,t.ObjectPool=e,t.Scene=a,t.System=class{constructor(t){this._manager=t}setComponentTypes(t){var e;this.typeNames=[];for(const n of t){const t=null!==(e=n.name)&&void 0!==e?e:n;s(this._manager.componentToEntityIDsMap.has(t),`Component '${t}' has not been registered!`),this.typeNames.push(t)}}getEntities(){if(null!==this._entityGetCache)return this._entityGetCache;this._entityGetCache=[];for(const t of this.typeNames){const e=this._manager.componentToEntityIDsMap.get(t);this._entityGetCache.push(...e)}return this._entityGetCache}},t.VERSION="0.0.0",t.assert=s,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=essem.min.js.map
